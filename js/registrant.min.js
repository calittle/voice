/*
 * VOICE - Registrant v1.0
 * Developed and maintanined by Charles Little, little_charles1@columbusstate.edu
 * Source repository: https://github.com/calittle/voice
 * Licensed under an Apache 2.0 license. See https://github.com/calittle/voice/blob/master/LICENSE for details.
 */
function login_user(e){request=$.ajax({url:"login_form.php",type:"post",data:e,success:function(e){var r=JSON.parse(e);1==r.success?(console.log("User logged in: "+e),$(".progress-bar").css("width","25%"),$(".progress-bar").css("aria-valuenow","25"),$("#progressbarvalue").html("25%"),$("#header_step_1").fadeOut(1500),$("#create_user_div").fadeOut(1500),$("#create_user_success").fadeIn(1500),$("#create_user_success").fadeOut(5e3),$("#header_step_2").fadeIn(1500),$("#registrant_div").fadeIn(1500)):(console.log(e),this.error(this.xhr,"Unable to login user",r.message))},error:function(e,r,t){$("#create_user_error_msg").html("There was a problem logging in your user account: "+r+t),$("#create_user_error").show(),$inputs.prop("disabled",!1)}})}function populate_parties(e){$.ajax({type:"post",url:"ajx_parties.php",success:function(e){var r=JSON.parse(e);$.each(r,function(e,r){$("#partyInput").append('<option value="'+r.PARTYCD+'">'+r.PARTY+"</option>")})},error:function(e,r,t){console.log(data),console.log("Error populating parties: "+r+","+t)}})}function populate_counties(e){var r;e&&(r=e.serialize()),$.ajax({type:"post",url:"ajx_counties.php",data:r,success:function(e){var r=JSON.parse(e);$.each(r,function(e,r){$("#countyInput").append('<option value="'+r.COUNTYCD+'">'+r.COUNTY+"</option>")})},error:function(e,r,t){console.log(data),console.log("Error populating counties: "+r+","+t)}})}function showlogin(){$("#header_step_1").fadeOut(450),$("#header_login").fadeIn(450),$("#create_user_div").fadeOut(500),$("#logindiv").fadeIn(50)}function populate_affirmations(e){$.ajax({type:"post",url:"ajx_affirms.php",success:function(e){var r=JSON.parse(e);$.each(r,function(e,r){$("#affirmations").append('<li vid="'+r.AFFIRM_ID+'">'+r.AFFIRMATION+"</li>")})},error:function(e,r,t){console.log(data),console.log("Error populating parties: "+r+","+t)}})}$(document).ready(function(e){e(function(){e("[data-hide]").on("click",function(){e(this).closest("."+e(this).attr("data-hide")).hide()})}),e("#phoneInput").mask("(999) 999-9999"),e("#birthDateInput").mask("9999-99-99",{placeholder:"yyyy-mm-dd}"}),e("#fedIdInput").mask("9999"),e("#postCodeInput").mask("99999?-9999"),e("#stateInput").bind("change keyup",function(r){e("#stateResidenceInput").val(e("#stateInput option:selected").val())}),jQuery.validator.addMethod("lettersonly",function(e,r){return this.optional(r)||/^[a-zA-Z\s]+$/i.test(e)},"Letters/spaces only please."),e(".input-group.date").datepicker({startView:2,format:"yyyy-mm-dd",showOnFocus:!1,autoclose:!0}),e("#passwordInput").keyup(function(r){var t=new RegExp("^(?=.{8,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\\W).*$","g"),s=new RegExp("^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$","g");return 0==new RegExp("(?=.{6,}).*","g").test(e(this).val())?e("#passstrength").html("Weak password. Please enter more characters."):t.test(e(this).val())?(e("#passstrength").removeClass().addClass("label label-success"),e("#passstrength").html("Good password.")):s.test(e(this).val())?(e("#passstrength").removeClass().addClass("label label-warning"),e("#passstrength").html("Ok password. Try mixed case and special characters.")):(e("#passstrength").removeClass().addClass("label label-danger"),e("#passstrength").html("Weak password. Add special characters, mixed case, and numbers.")),!0}),e("#locationform").validate({rules:{street1Input:{required:!0,minlength:5,maxlength:256},street2Input:{required:!1,minlength:5,maxlength:256},cityInput:{required:!0,minlength:2,maxlength:256,lettersonly:!0},postCodeInput:{required:!0},stateResidenceInput:{required:!0},countryInput:{required:!0}},highlight:function(r){e(r).closest(".form-group").addClass("has-error")},unhighlight:function(r){e(r).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,r){r.parent(".input-group").length?e.insertAfter(r.parent()):e.insertAfter(r)}}),e("#affirmForm").validate({rules:{partyInput:{required:!1}},highlight:function(r){e(r).closest(".form-group").addClass("has-error")},unhighlight:function(r){e(r).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,r){r.parent(".input-group").length?e.insertAfter(r.parent()):e.insertAfter(r)}}),e("#registrant_form").validate({rules:{suffixNameInput:{minlength:1,maxlength:256,required:!1},lastNameInput:{minlength:3,maxlength:256,lettersonly:!0,required:!0},middleNameInput:{minlength:3,maxlength:256,lettersonly:!0,required:!1},firstNameInput:{minlength:3,maxlength:256,lettersonly:!0,required:!0},birthDateInput:{minlength:8,maxlength:10,required:!0},phoneInput:{required:!1},stateIdInput:{maxlength:256,required:!1},fedIdInput:{maxlength:4,required:!0},stateInput:{required:!0}},highlight:function(r){e(r).closest(".form-group").addClass("has-error")},unhighlight:function(r){e(r).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,r){r.parent(".input-group").length?e.insertAfter(r.parent()):e.insertAfter(r)}}),e("#loginform").validate({rules:{usernameInput:{minlength:3,maxlength:256,required:!0},passwordInput:{minlength:8,maxlength:64,required:!0}},highlight:function(r){e(r).closest(".form-group").addClass("has-error")},unhighlight:function(r){e(r).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,r){r.parent(".input-group").length?e.insertAfter(r.parent()):e.insertAfter(r)}}),e("#createuserform").validate({rules:{usernameInput:{minlength:3,maxlength:256,required:!0},emailInput:{minlength:5,maxlength:256,required:!0},passwordInput:{minlength:8,maxlength:64,required:!0}},highlight:function(r){e(r).closest(".form-group").addClass("has-error")},unhighlight:function(r){e(r).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,r){r.parent(".input-group").length?e.insertAfter(r.parent()):e.insertAfter(r)}});var r;e("#registrant_form").submit(function(t){if(1!=e("#registrant_form").valid())return!1;t.preventDefault(),r&&r.abort();var s=e(this),a=s.find("input, button, select, option"),n=s.serialize();a.prop("disabled",!0),r=e.ajax({url:"registrant_form.php",type:"post",data:n,success:function(r){var t=JSON.parse(r);1==t.success?(console.log("Added registrant data: "+r),populate_parties(this),populate_affirmations(this),e(".progress-bar").css("width","50%"),e(".progress-bar").css("aria-valuenow","50"),e("#progressbarvalue").html("50%"),e("#header_step_2").fadeOut(1500),e("#registrant_div").fadeOut(1500),e("#registrant_success").fadeIn(1500),e("#registrant_success").fadeOut(5e3),e("#header_step_3").fadeIn(1500),e("#registrant2_div").fadeIn(1500)):(console.log("Unable to add registrant data:"+r),this.error(this.xhr,"Unable to add registrant data",t.message),a.prop("disabled",!1))},error:function(r,t,s){e("#registrant_error_msg").html("There was a problem adding your registrant data: "+t+s),e("#registrant_error").show(),a.prop("disabled",!1)}})}),e("#loginform").submit(function(t){if(1!=e("#loginform").valid())return!1;t.preventDefault(),r&&r.abort();var s=e(this),a=s.find("input, button"),n=s.serialize();a.prop("disabled",!0),r=e.ajax({url:"login_form.php",type:"post",data:n,success:function(r){var t=JSON.parse(r);1==t.success?(console.log("User logged in: "+r),e(".progress-bar").css("width","25%"),e(".progress-bar").css("aria-valuenow","25"),e("#progressbarvalue").html("25%"),e("#header_login").fadeOut(1500),e("#logindiv").fadeOut(1500),e("#loginsuccess").fadeIn(1500),e("#loginsuccess").fadeOut(5e3),e("#header_step_2").fadeIn(1500),e("#registrant_div").fadeIn(1500)):(console.log(r),this.error(this.xhr,"Unable to login user",t.message))},error:function(r,t,s){e("#loginerrormessage").html("There was a problem logging in your user account: "+t+s),e("#loginerror").show(),a.prop("disabled",!1)}})}),e("#createuserform").submit(function(t){if(1!=e("#createuserform").valid())return!1;t.preventDefault(),r&&r.abort();var s=e(this),a=s.find("input, button"),n=s.serialize();a.prop("disabled",!0),r=e.ajax({url:"user_form.php",type:"post",data:n,success:function(e){var r=JSON.parse(e);1==r.success?(console.log("Created user account: "+e),login_user(n)):(console.log(e),this.error(this.xhr,"Unable to create user account.",r.message))},error:function(r,t,s){e("#create_user_error_msg").html("There was a problem creating your user account: "+t+s),e("#create_user_error").show(),a.prop("disabled",!1)}})}),e("#affirmForm").submit(function(t){if(1!=e("#affirmForm").valid())return!1;t.preventDefault(),r&&r.abort();var s=e(this),a=s.find("input, button"),n=s.serialize();a.prop("disabled",!0),r=e.ajax({url:"registrant2_form.php",type:"post",data:n,success:function(r){var t=JSON.parse(r);1==t.success?(console.log("Saved affirmations : "+r),e(".progress-bar").css("width","75%"),e(".progress-bar").css("aria-valuenow","75"),e("#progressbarvalue").html("75%"),e("#header_step_3").fadeOut(1500),e("#registrant2_div").fadeOut(1500),e("#registrant_success").fadeIn(1500),e("#registrant_success").fadeOut(5e3),e("#header_step_4").fadeIn(1500),e("#residence_div").fadeIn(1500),populate_counties()):(console.log(r),this.error(this.xhr,"Unable to save affirmations.",t.message))},error:function(r,t,s){e("#registrant2_error_msg").html("There was a problem saving your affirmation information: "+t+s),e("#registrant2_error").show(),a.prop("disabled",!1)}})}),e("#locationform").submit(function(t){if(1!=e("#locationform").valid())return!1;t.preventDefault(),r&&r.abort();var s=e(this),a=s.find("input, button"),n=s.serialize();a.prop("disabled",!0),console.log("location:"+n),r=e.ajax({url:"location_add.php",type:"post",data:n,success:function(r){console.log(r);var t;try{1==(t=JSON.parse(r)).success?(console.log("Saved affirmations : "+r),e(".progress-bar").css("width","100%"),e(".progress-bar").css("aria-valuenow","100"),e("#progressbarvalue").html("100%"),e("#header_step_3").fadeOut(1500),e("#registrant2_div").fadeOut(1500),e("#residence_success").fadeIn(1500),e("#residence_success").fadeOut(5e3),e("#header_step_4").fadeOut(1500),e("#residence_div").fadeOut(1500),e("#final").fadeIn(1e3)):(console.log(r),this.error(this.xhr,"Unable to save residence.",t.message))}catch(e){this.error(this.xhr,"Unable to save residence.",e.message)}},error:function(r,t,s){e("#residence_error_msg").html("There was a problem saving your residence information: "+t+s),e("#residence_error").show(),a.prop("disabled",!1)}})})});